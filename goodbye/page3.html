<!DOCTYPE html>
<meta charset="utf-8">
<style>

.link {
  fill: none;
  stroke: #000;
}

.node {
  stroke: #fff;
}

</style>
<body>
<script src="../../d3.v2.js"></script>
<script>

var margin = {top: 0, right: 40, bottom: 0, left: 40},
    width = 800 - margin.left - margin.right,
    height = 800 - margin.top - margin.bottom;
var cScale=d3.scale.linear().domain([0,4]).range(["#ccc","darkorange"]);
var fScale=d3.scale.linear().domain([0,10,100]).range([0,12,48]).clamp([true]);
var pack = d3.layout.pack()
    .size([width - 4, height - 4])
    .sort(function(a,b){return 10000*(b.deg-a.deg)+Math.random();//Math.random()-.5;
    })
    .value(function(d) { return d.size; });

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
var data,n,debugD;
var years=d3.range(2004,2013);
d3.csv("dataMsg.csv", function(csv) {
  data=csv;
  console.log("data loaded.")
  n={name:"emails",children:[]};
  csv.forEach(function(d) {
    /*var myChild=[];
    years.forEach(function(y) {
      if(d[y]) {myChild.push({name:y,size:d[y]});}
    })
    n.children.push({name:d.name,dir:d.dir,dep:d.dep,deg:d.deg,children:myChild});*/
    n.children.push({
      name:d.name,
      dir:d.dir,
      dep:d.dep,
      deg:+d.deg,
      size:+d.nbMsg});
  })

console.log("data arranged");
  var node = svg.data([n]).selectAll("g.node")
      .data(pack.nodes)
    .enter().append("g")
      .attr("class", function(d) { return d.children ? "node node"+d.depth : "leaf node"; })
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
      
  

  //node.append("title")
  //    .text(function(d) { return d.name + (d.children ? "" : ": " + format(d.size)); });

  node.append("circle")
      .attr("r", function(d) { return d.r; })
      .style("stroke","#888")
      .style("fill",function(d) {return d.depth ? cScale(d.deg) : "none";})
      //.style("stroke",function(d) {return d.depth===2 ? "none":"#eee"})

  /*d3.selectAll(".node1").append("text").text(function(d) {return d.name;})
    .attr("text-anchor","middle")
    .style("visibility",function(d) {return d.children.length>=10?"visible":"hidden"})
    .style("font-size",function(d) {return fScale(d.children.length);});*/
    

  /*node.filter(function(d) { return !d.children; }).append("text")
      .attr("text-anchor", "middle")
      .attr("dy", ".3em")
      .text(function(d) { return d.name.substring(0, d.r / 3); });*/

});

</script>