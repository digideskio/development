<!DOCTYPE html>
<meta charset="utf-8">
<style>
.bar {
  fill: steelblue;
  stroke: none;
}
.selected {
  fill: red;
}
.readme {
  font-family: Helvetica Neue, Helvetica, Arial sans-serif;
  max-width: 960px;
}
</style>
<body>
<script src="../d3.v2.js"></script>
<script>

// a simple random data generator
var _id_ = 0;
function generate() {
	return { index: _id_++, value: 5 + 95*Math.random() };
}

// instantiate 100 random values
var data = d3.range(100).map(generate);

// set desired size for bar chart
var w = 900,
    h = 100,
    bw = 9;

// set scale for y-values
var y = d3.scale.linear().domain([0,100]).range([0,100]);

// add a key function to uniquely id data values
var key = function(d) { return d.index; }

// add svg element
var svg = d3.select("body").append("svg")
    .attr("width", w)
    .attr("height", h);

// add bar chart as collection of rects
svg.selectAll("rect.bar")
    // include key function within data join
    .data(data, function(d) { return d.index; })
  .enter().append("rect")
    .attr("class", "bar")
    .attr("x", function(d,i) { return i*bw; })
    .attr("width", bw-1)
    .attr("y", function(d) { return h - y(d.value); })
    .attr("height", function(d) { return y(d.value); })
    .on("mouseover", function(d) {
        d3.select(this).classed("selected", true);
    })
    .on("mouseout", function(d) {
        d3.select(this).classed("selected", false);
    });

// process data update
function update() {
	data.shift();           // remove oldest element
	data.push(generate()); // add new data element
	
    // re-select bar marks using key function
    var bars = svg.selectAll("rect.bar")
        .data(data, function(d) { return d.index; });

    // add rect for incoming data
    bars.enter().append("rect")
        .attr("class", "bar")
        .attr("x", w)
        .attr("width", bw-1)
        .attr("y", function(d) { return h - y(d.value); })
        .attr("height", function(d) { return y(d.value); })
        .on("mouseover", function(d) {
            d3.select(this).classed("selected", true);
        })
        .on("mouseout", function(d) {
            d3.select(this).classed("selected", false);
        });

    // re-position bars along x-axis with animation
    // bars now contains both the enter and update sets
    bars.transition()
        .duration(500)
        .attr("x", function(d,i) { return i*bw; });

    // re-position and then remove exiting data
    bars.exit().transition()
        .duration(500)
        .attr("x", -bw)
        .remove();   
}

// update data every 2 seconds
setInterval(update, 2000);

</script>
<div class="readme">
<h3>Dynamic Bar Chart</h3>
<p>
This example will lead you step-by-step to build an animated bar chart with dynamic data.
For each step, you should view source: each new piece of code will be annotated with a comment.
</p>
<ol>
  <li><a href="01-generate-data.html">Generate Random Data</a></li>
  <li><a href="02-add-bars.html">Add Bar Chart</a></li>
  <li><a href="03-add-scale.html">Add Scale</a></li>
  <li><a href="04-add-hover.html">Add Mouse Hover</a></li>
  <li><a href="05-add-update.html">Add Dynamic Data Update</a></li>
  <li><a href="06-add-transition.html">Add Animated Transition</a></li>
  <li><a href="07-add-key.html">Add Key Function to Data Join</a></li>
  <li><a href="08-final.html">Final Version (handle exit selection)</a></li>
</ol>
</div>