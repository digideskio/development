<!DOCTYPE html>
<meta charset="utf-8">
<style>
.bar {
  fill: steelblue;
  stroke: none;
}
.selected {
  fill: red;
}
</style>
<body>
<script src="../d3.v2.js"></script>
<script>
var _id_ = 0;
function generate() {
	return { index: _id_++, value: 5 + 95*Math.random() };
}

var data = d3.range(100).map(generate);

var w = 900,
    h = 100,
    bw = 9;

var y = d3.scale.linear().domain([0,100]).range([0,100]);

// add a key function to uniquely id data values
var key = function(d) { return d.index; }

var svg = d3.select("body").append("svg")
    .attr("width", w)
    .attr("height", h);

svg.selectAll("rect.bar")
    // include key function within data join
    .data(data, function(d) { return d.index; })
  .enter().append("rect")
    .attr("class", "bar")
    .attr("x", function(d,i) { return i*bw; })
    .attr("width", bw-1)
    .attr("y", function(d) { return h - y(d.value); })
    .attr("height", function(d) { return y(d.value); })
    .on("mouseover", function(d) {
        d3.select(this).classed("selected", true);
    })
    .on("mouseout", function(d) {
        d3.select(this).classed("selected", false);
    });

function update() {
	data.shift();
	data.push(generate());
	
    // re-select bar marks using key function
    var bars = svg.selectAll("rect.bar")
        .data(data, key);

    // add rect for incoming data
    bars.enter().append("rect")
        .attr("class", "bar")
        .attr("x", w)
        .attr("width", bw-1)
        .attr("y", function(d) { return h - y(d.value); })
        .attr("height", function(d) { return y(d.value); })
        .on("mouseover", function(d) {
            d3.select(this).classed("selected", true);
        })
        .on("mouseout", function(d) {
            d3.select(this).classed("selected", false);
        });

    // re-position bars along x-axis with animation
    // bars now contains both the enter and update sets
    bars.transition()
        .duration(500)
        .attr("x", function(d,i) { return i*bw; });  
}

// update data every 2 seconds
setInterval(update, 2000);

</script>