<html>
	<head>
		<meta http-equiv="content-type" content="text/html;charset=utf-8">
		<script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?2.0.0"></script>
		<!--<script type="text/javascript" src="http://blog.oecdfactblog.org/wp-includes/js/protovis-r3.2.js"></script>-->
		<style>
			@import url("http://mbostock.github.com/d3/style.css?1.10.0");
			@import url("http://mbostock.github.com/d3/syntax.css?1.10.0");
		</style>
		<style>
		.cell {
			position:absolute;
			overflow:hidden;
			height:20;
			width:20;
			border:1px solid white;
			text-align:center;
			vertical-align:middle;
			}
		.cellSVG {height:20;width:20;}
		</style>
	</head>
	<body>
		<div id="mode">
		mode:3
		</div>
		<div id="info">
		</div>
		<div id="chart">
		</div>

		<script type="text/javascript">
		var k=0.707106781;
		var depth=k/2;
		var u=10;
		var a=u*depth;

		var s=u+2*a;

		var attrProba=[[15,15,10,7,6,4,2,2,2],
					   [1,1,1,1,1,1,1,1,1],
					   [3,5,2,4,6,4,2,1,5],
					   [20,20,20,20,5,5,5,5,5],
					   [1,2,3,4,5,6,7,8,9],
					   [60,50,40,20,10,30,70,80,90]];

		attrProba=attrProba.map(function(v) {return v.map(function(d) {return d/d3.sum(v);});})

		function detAttr(arg,attr) {var i=0;p=attrProba[attr][0];while(i<attrProba[attr].length){if(arg<p){return i;}else{p+=attrProba[attr][++i];}}}

		data=d3.range(1000).map(function(d) {return {'attr':d3.range(6).map(function(d) {return detAttr(Math.random(),d);}), 'id':d};})

		//var dist=[{x:0,y:0},{x:-1,y:0},{x:0,y:-1},{x:0,y:1},{x:1,y:0},{x:-1,y:-1},{x:-1,y:1},{x:1,y:-1},{x:1,y:1},{x:-2,y:0},{x:0,y:-2},{x:0,y:2},{x:2,y:0},{x:-2,y:-1},{x:-2,y:1},{x:-1,y:-2},{x:-1,y:2},{x:1,y:-2},{x:1,y:2},{x:2,y:-1},{x:2,y:1},{x:-2,y:-2},{x:-2,y:2},{x:2,y:-2},{x:2,y:2},{x:-3,y:0},{x:0,y:-3},{x:0,y:3},{x:3,y:0},{x:-3,y:-1},{x:-3,y:1},{x:-1,y:-3},{x:-1,y:3},{x:1,y:-3},{x:1,y:3},{x:3,y:-1},{x:3,y:1},{x:-3,y:-2},{x:-3,y:2},{x:-2,y:-3},{x:-2,y:3},{x:2,y:-3},{x:2,y:3},{x:3,y:-2},{x:3,y:2},{x:-4,y:0},{x:0,y:-4},{x:0,y:4},{x:4,y:0},{x:-4,y:-1},{x:-4,y:1},{x:-1,y:-4},{x:-1,y:4},{x:1,y:-4},{x:1,y:4},{x:4,y:-1},{x:4,y:1},{x:-3,y:-3},{x:-3,y:3},{x:3,y:-3},{x:3,y:3},{x:-4,y:-2},{x:-4,y:2},{x:-2,y:-4},{x:-2,y:4},{x:2,y:-4},{x:2,y:4},{x:4,y:-2},{x:4,y:2},{x:-5,y:0},{x:-4,y:-3},{x:-4,y:3},{x:-3,y:-4},{x:-3,y:4},{x:0,y:-5},{x:0,y:5},{x:3,y:-4},{x:3,y:4},{x:4,y:-3},{x:4,y:3},{x:5,y:0},{x:-5,y:-1},{x:-5,y:1},{x:-1,y:-5},{x:-1,y:5},{x:1,y:-5},{x:1,y:5},{x:5,y:-1},{x:5,y:1},{x:-5,y:-2},{x:-5,y:2},{x:-2,y:-5},{x:-2,y:5},{x:2,y:-5},{x:2,y:5},{x:5,y:-2},{x:5,y:2},{x:-4,y:-4},{x:-4,y:4},{x:4,y:-4},{x:4,y:4},{x:-5,y:-3},{x:-5,y:3},{x:-3,y:-5},{x:-3,y:5},{x:3,y:-5},{x:3,y:5},{x:5,y:-3},{x:5,y:3},{x:-6,y:0},{x:0,y:-6},{x:0,y:6},{x:6,y:0},{x:-6,y:-1},{x:-6,y:1},{x:-1,y:-6},{x:-1,y:6},{x:1,y:-6},{x:1,y:6},{x:6,y:-1},{x:6,y:1},{x:-6,y:-2},{x:-6,y:2},{x:-2,y:-6},{x:-2,y:6},{x:2,y:-6},{x:2,y:6},{x:6,y:-2},{x:6,y:2},{x:-5,y:-4},{x:-5,y:4},{x:-4,y:-5},{x:-4,y:5},{x:4,y:-5},{x:4,y:5},{x:5,y:-4},{x:5,y:4},{x:-6,y:-3},{x:-6,y:3},{x:-3,y:-6},{x:-3,y:6},{x:3,y:-6},{x:3,y:6},{x:6,y:-3},{x:6,y:3},{x:-7,y:0},{x:0,y:-7},{x:0,y:7},{x:7,y:0},{x:-7,y:-1},{x:-7,y:1},{x:-5,y:-5},{x:-5,y:5},{x:-1,y:-7},{x:-1,y:7},{x:1,y:-7},{x:1,y:7},{x:5,y:-5},{x:5,y:5},{x:7,y:-1},{x:7,y:1},{x:-6,y:-4},{x:-6,y:4},{x:-4,y:-6},{x:-4,y:6},{x:4,y:-6},{x:4,y:6},{x:6,y:-4},{x:6,y:4},{x:-7,y:-2},{x:-7,y:2},{x:-2,y:-7},{x:-2,y:7},{x:2,y:-7},{x:2,y:7},{x:7,y:-2},{x:7,y:2},{x:-7,y:-3},{x:-7,y:3},{x:-3,y:-7},{x:-3,y:7},{x:3,y:-7},{x:3,y:7},{x:7,y:-3},{x:7,y:3},{x:-6,y:-5},{x:-6,y:5},{x:-5,y:-6},{x:-5,y:6},{x:5,y:-6},{x:5,y:6},{x:6,y:-5},{x:6,y:5},{x:-8,y:0},{x:0,y:-8},{x:0,y:8},{x:8,y:0},{x:-8,y:-1},{x:-8,y:1},{x:-7,y:-4},{x:-7,y:4},{x:-4,y:-7},{x:-4,y:7},{x:-1,y:-8},{x:-1,y:8},{x:1,y:-8},{x:1,y:8},{x:4,y:-7},{x:4,y:7},{x:7,y:-4},{x:7,y:4},{x:8,y:-1},{x:8,y:1},{x:-8,y:-2},{x:-8,y:2},{x:-2,y:-8},{x:-2,y:8},{x:2,y:-8},{x:2,y:8},{x:8,y:-2},{x:8,y:2},{x:-6,y:-6},{x:-6,y:6},{x:6,y:-6},{x:6,y:6},{x:-8,y:-3},{x:-8,y:3},{x:-3,y:-8},{x:-3,y:8},{x:3,y:-8},{x:3,y:8},{x:8,y:-3},{x:8,y:3},{x:-7,y:-5},{x:-7,y:5},{x:-5,y:-7},{x:-5,y:7},{x:5,y:-7},{x:5,y:7},{x:7,y:-5},{x:7,y:5},{x:-8,y:-4},{x:-8,y:4},{x:-4,y:-8},{x:-4,y:8},{x:4,y:-8},{x:4,y:8},{x:8,y:-4},{x:8,y:4},{x:-9,y:0},{x:0,y:-9},{x:0,y:9},{x:9,y:0},{x:-9,y:-1},{x:-9,y:1},{x:-1,y:-9},{x:-1,y:9},{x:1,y:-9},{x:1,y:9},{x:9,y:-1},{x:9,y:1},{x:-9,y:-2},{x:-9,y:2},{x:-7,y:-6},{x:-7,y:6},{x:-6,y:-7},{x:-6,y:7},{x:-2,y:-9},{x:-2,y:9},{x:2,y:-9},{x:2,y:9},{x:6,y:-7},{x:6,y:7},{x:7,y:-6},{x:7,y:6},{x:9,y:-2},{x:9,y:2},{x:-8,y:-5},{x:-8,y:5},{x:-5,y:-8},{x:-5,y:8},{x:5,y:-8},{x:5,y:8},{x:8,y:-5},{x:8,y:5},{x:-9,y:-3},{x:-9,y:3},{x:-3,y:-9},{x:-3,y:9},{x:3,y:-9},{x:3,y:9},{x:9,y:-3},{x:9,y:3},{x:-9,y:-4},{x:-9,y:4},{x:-4,y:-9},{x:-4,y:9},{x:4,y:-9},{x:4,y:9},{x:9,y:-4},{x:9,y:4},{x:-7,y:-7},{x:-7,y:7},{x:7,y:-7},{x:7,y:7},{x:-10,y:0},{x:-8,y:-6},{x:-8,y:6},{x:-6,y:-8},{x:-6,y:8},{x:0,y:-10},{x:0,y:10},{x:6,y:-8},{x:6,y:8},{x:8,y:-6},{x:8,y:6},{x:10,y:0},{x:-10,y:-1},{x:-10,y:1},{x:-1,y:-10},{x:-1,y:10},{x:1,y:-10},{x:1,y:10},{x:10,y:-1},{x:10,y:1},{x:-10,y:-2},{x:-10,y:2},{x:-2,y:-10},{x:-2,y:10},{x:2,y:-10},{x:2,y:10},{x:10,y:-2},{x:10,y:2},{x:-9,y:-5},{x:-9,y:5},{x:-5,y:-9},{x:-5,y:9},{x:5,y:-9},{x:5,y:9},{x:9,y:-5},{x:9,y:5},{x:-10,y:-3},{x:-10,y:3},{x:-3,y:-10},{x:-3,y:10},{x:3,y:-10},{x:3,y:10},{x:10,y:-3},{x:10,y:3},{x:-8,y:-7},{x:-8,y:7},{x:-7,y:-8},{x:-7,y:8},{x:7,y:-8},{x:7,y:8},{x:8,y:-7},{x:8,y:7},{x:-10,y:-4},{x:-10,y:4},{x:-4,y:-10},{x:-4,y:10},{x:4,y:-10},{x:4,y:10},{x:10,y:-4},{x:10,y:4},{x:-9,y:-6},{x:-9,y:6},{x:-6,y:-9},{x:-6,y:9},{x:6,y:-9},{x:6,y:9},{x:9,y:-6},{x:9,y:6},{x:-11,y:0},{x:0,y:-11},{x:0,y:11},{x:11,y:0},{x:-11,y:-1},{x:-11,y:1},{x:-1,y:-11},{x:-1,y:11},{x:1,y:-11},{x:1,y:11},{x:11,y:-1},{x:11,y:1},{x:-11,y:-2},{x:-11,y:2},{x:-10,y:-5},{x:-10,y:5},{x:-5,y:-10},{x:-5,y:10},{x:-2,y:-11},{x:-2,y:11},{x:2,y:-11},{x:2,y:11},{x:5,y:-10},{x:5,y:10},{x:10,y:-5},{x:10,y:5},{x:11,y:-2},{x:11,y:2},{x:-8,y:-8},{x:-8,y:8},{x:8,y:-8},{x:8,y:8},{x:-11,y:-3},{x:-11,y:3},{x:-9,y:-7},{x:-9,y:7},{x:-7,y:-9},{x:-7,y:9},{x:-3,y:-11},{x:-3,y:11},{x:3,y:-11},{x:3,y:11},{x:7,y:-9},{x:7,y:9},{x:9,y:-7},{x:9,y:7},{x:11,y:-3},{x:11,y:3},{x:-10,y:-6},{x:-10,y:6},{x:-6,y:-10},{x:-6,y:10},{x:6,y:-10},{x:6,y:10},{x:10,y:-6},{x:10,y:6},{x:-11,y:-4},{x:-11,y:4},{x:-4,y:-11},{x:-4,y:11},{x:4,y:-11},{x:4,y:11},{x:11,y:-4},{x:11,y:4},{x:-12,y:0},{x:0,y:-12},{x:0,y:12},{x:12,y:0},{x:-12,y:-1},{x:-12,y:1},{x:-9,y:-8},{x:-9,y:8},{x:-8,y:-9},{x:-8,y:9},{x:-1,y:-12},{x:-1,y:12},{x:1,y:-12},{x:1,y:12},{x:8,y:-9},{x:8,y:9},{x:9,y:-8},{x:9,y:8},{x:12,y:-1},{x:12,y:1},{x:-11,y:-5},{x:-11,y:5},{x:-5,y:-11},{x:-5,y:11},{x:5,y:-11},{x:5,y:11},{x:11,y:-5},{x:11,y:5},{x:-12,y:-2},{x:-12,y:2},{x:-2,y:-12},{x:-2,y:12},{x:2,y:-12},{x:2,y:12},{x:12,y:-2},{x:12,y:2},{x:-10,y:-7},{x:-10,y:7},{x:-7,y:-10},{x:-7,y:10},{x:7,y:-10},{x:7,y:10},{x:10,y:-7},{x:10,y:7},{x:-12,y:-3},{x:-12,y:3},{x:-3,y:-12},{x:-3,y:12},{x:3,y:-12},{x:3,y:12},{x:12,y:-3},{x:12,y:3},{x:-11,y:-6},{x:-11,y:6},{x:-6,y:-11},{x:-6,y:11},{x:6,y:-11},{x:6,y:11},{x:11,y:-6},{x:11,y:6},{x:-12,y:-4},{x:-12,y:4},{x:-4,y:-12},{x:-4,y:12},{x:4,y:-12},{x:4,y:12},{x:12,y:-4},{x:12,y:4},{x:-9,y:-9},{x:-9,y:9},{x:9,y:-9},{x:9,y:9},{x:-10,y:-8},{x:-10,y:8},{x:-8,y:-10},{x:-8,y:10},{x:8,y:-10},{x:8,y:10},{x:10,y:-8},{x:10,y:8},{x:-13,y:0},{x:-12,y:-5},{x:-12,y:5},{x:-5,y:-12},{x:-5,y:12},{x:0,y:-13},{x:0,y:13},{x:5,y:-12},{x:5,y:12},{x:12,y:-5},{x:12,y:5},{x:13,y:0},{x:-13,y:-1},{x:-13,y:1},{x:-11,y:-7},{x:-11,y:7},{x:-7,y:-11},{x:-7,y:11},{x:-1,y:-13},{x:-1,y:13},{x:1,y:-13},{x:1,y:13},{x:7,y:-11},{x:7,y:11},{x:11,y:-7},{x:11,y:7},{x:13,y:-1},{x:13,y:1},{x:-13,y:-2},{x:-13,y:2},{x:-2,y:-13},{x:-2,y:13},{x:2,y:-13},{x:2,y:13},{x:13,y:-2},{x:13,y:2},{x:-13,y:-3},{x:-13,y:3},{x:-3,y:-13},{x:-3,y:13},{x:3,y:-13},{x:3,y:13},{x:13,y:-3},{x:13,y:3},{x:-12,y:-6},{x:-12,y:6},{x:-6,y:-12},{x:-6,y:12},{x:6,y:-12},{x:6,y:12},{x:12,y:-6},{x:12,y:6},{x:-10,y:-9},{x:-10,y:9},{x:-9,y:-10},{x:-9,y:10},{x:9,y:-10},{x:9,y:10},{x:10,y:-9},{x:10,y:9},{x:-13,y:-4},{x:-13,y:4},{x:-11,y:-8},{x:-11,y:8},{x:-8,y:-11},{x:-8,y:11},{x:-4,y:-13},{x:-4,y:13},{x:4,y:-13},{x:4,y:13},{x:8,y:-11},{x:8,y:11},{x:11,y:-8},{x:11,y:8},{x:13,y:-4},{x:13,y:4},{x:-12,y:-7},{x:-12,y:7},{x:-7,y:-12},{x:-7,y:12},{x:7,y:-12},{x:7,y:12},{x:12,y:-7},{x:12,y:7},{x:-13,y:-5},{x:-13,y:5},{x:-5,y:-13},{x:-5,y:13},{x:5,y:-13},{x:5,y:13},{x:13,y:-5},{x:13,y:5},{x:-14,y:0},{x:0,y:-14},{x:0,y:14},{x:14,y:0},{x:-14,y:-1},{x:-14,y:1},{x:-1,y:-14},{x:-1,y:14},{x:1,y:-14},{x:1,y:14},{x:14,y:-1},{x:14,y:1},{x:-14,y:-2},{x:-14,y:2},{x:-10,y:-10},{x:-10,y:10},{x:-2,y:-14},{x:-2,y:14},{x:2,y:-14},{x:2,y:14},{x:10,y:-10},{x:10,y:10},{x:14,y:-2},{x:14,y:2},{x:-11,y:-9},{x:-11,y:9},{x:-9,y:-11},{x:-9,y:11},{x:9,y:-11},{x:9,y:11},{x:11,y:-9},{x:11,y:9},{x:-14,y:-3},{x:-14,y:3},{x:-13,y:-6},{x:-13,y:6},{x:-6,y:-13},{x:-6,y:13},{x:-3,y:-14},{x:-3,y:14},{x:3,y:-14},{x:3,y:14},{x:6,y:-13},{x:6,y:13},{x:13,y:-6},{x:13,y:6},{x:14,y:-3},{x:14,y:3},{x:-12,y:-8},{x:-12,y:8},{x:-8,y:-12},{x:-8,y:12},{x:8,y:-12},{x:8,y:12},{x:12,y:-8},{x:12,y:8},{x:-14,y:-4},{x:-14,y:4},{x:-4,y:-14},{x:-4,y:14},{x:4,y:-14},{x:4,y:14},{x:14,y:-4},{x:14,y:4},{x:-13,y:-7},{x:-13,y:7},{x:-7,y:-13},{x:-7,y:13},{x:7,y:-13},{x:7,y:13},{x:13,y:-7},{x:13,y:7},{x:-14,y:-5},{x:-14,y:5},{x:-11,y:-10},{x:-11,y:10},{x:-10,y:-11},{x:-10,y:11},{x:-5,y:-14},{x:-5,y:14},{x:5,y:-14},{x:5,y:14},{x:10,y:-11},{x:10,y:11},{x:11,y:-10},{x:11,y:10},{x:14,y:-5},{x:14,y:5},{x:-15,y:0},{x:-12,y:-9},{x:-12,y:9},{x:-9,y:-12},{x:-9,y:12},{x:0,y:-15},{x:0,y:15},{x:9,y:-12},{x:9,y:12},{x:12,y:-9},{x:12,y:9},{x:15,y:0},{x:-15,y:-1},{x:-15,y:1},{x:-1,y:-15},{x:-1,y:15},{x:1,y:-15},{x:1,y:15},{x:15,y:-1},{x:15,y:1},{x:-15,y:-2},{x:-15,y:2},{x:-2,y:-15},{x:-2,y:15},{x:2,y:-15},{x:2,y:15},{x:15,y:-2},{x:15,y:2},{x:-14,y:-6},{x:-14,y:6},{x:-6,y:-14},{x:-6,y:14},{x:6,y:-14},{x:6,y:14},{x:14,y:-6},{x:14,y:6},{x:-13,y:-8},{x:-13,y:8},{x:-8,y:-13},{x:-8,y:13},{x:8,y:-13},{x:8,y:13},{x:13,y:-8},{x:13,y:8},{x:-15,y:-3},{x:-15,y:3},{x:-3,y:-15},{x:-3,y:15},{x:3,y:-15},{x:3,y:15},{x:15,y:-3},{x:15,y:3},{x:-15,y:-4},{x:-15,y:4},{x:-4,y:-15},{x:-4,y:15},{x:4,y:-15},{x:4,y:15},{x:15,y:-4},{x:15,y:4},{x:-11,y:-11},{x:-11,y:11},{x:11,y:-11},{x:11,y:11},{x:-12,y:-10},{x:-12,y:10},{x:-10,y:-12},{x:-10,y:12},{x:10,y:-12},{x:10,y:12},{x:12,y:-10},{x:12,y:10},{x:-14,y:-7},{x:-14,y:7},{x:-7,y:-14},{x:-7,y:14},{x:7,y:-14},{x:7,y:14},{x:14,y:-7},{x:14,y:7},{x:-15,y:-5},{x:-15,y:5},{x:-13,y:-9},{x:-13,y:9},{x:-9,y:-13},{x:-9,y:13},{x:-5,y:-15},{x:-5,y:15},{x:5,y:-15},{x:5,y:15},{x:9,y:-13},{x:9,y:13},{x:13,y:-9},{x:13,y:9},{x:15,y:-5},{x:15,y:5},{x:-16,y:0},{x:0,y:-16},{x:0,y:16},{x:16,y:0},{x:-16,y:-1},{x:-16,y:1},{x:-1,y:-16},{x:-1,y:16},{x:1,y:-16},{x:1,y:16},{x:16,y:-1},{x:16,y:1},{x:-16,y:-2},{x:-16,y:2},{x:-14,y:-8},{x:-14,y:8},{x:-8,y:-14},{x:-8,y:14},{x:-2,y:-16},{x:-2,y:16},{x:2,y:-16},{x:2,y:16},{x:8,y:-14},{x:8,y:14},{x:14,y:-8},{x:14,y:8},{x:16,y:-2},{x:16,y:2},{x:-15,y:-6},{x:-15,y:6},{x:-6,y:-15},{x:-6,y:15},{x:6,y:-15},{x:6,y:15},{x:15,y:-6},{x:15,y:6},{x:-16,y:-3},{x:-16,y:3},{x:-12,y:-11},{x:-12,y:11},{x:-11,y:-12},{x:-11,y:12},{x:-3,y:-16},{x:-3,y:16},{x:3,y:-16},{x:3,y:16},{x:11,y:-12},{x:11,y:12},{x:12,y:-11},{x:12,y:11},{x:16,y:-3},{x:16,y:3},{x:-13,y:-10},{x:-13,y:10},{x:-10,y:-13},{x:-10,y:13},{x:10,y:-13},{x:10,y:13},{x:13,y:-10},{x:13,y:10},{x:-16,y:-4},{x:-16,y:4},{x:-4,y:-16},{x:-4,y:16},{x:4,y:-16},{x:4,y:16},{x:16,y:-4},{x:16,y:4},{x:-15,y:-7},{x:-15,y:7},{x:-7,y:-15},{x:-7,y:15},{x:7,y:-15},{x:7,y:15},{x:15,y:-7},{x:15,y:7},{x:-14,y:-9},{x:-14,y:9},{x:-9,y:-14},{x:-9,y:14},{x:9,y:-14},{x:9,y:14},{x:14,y:-9},{x:14,y:9},{x:-16,y:-5},{x:-16,y:5},{x:-5,y:-16},{x:-5,y:16},{x:5,y:-16},{x:5,y:16},{x:16,y:-5},{x:16,y:5},{x:-12,y:-12},{x:-12,y:12},{x:12,y:-12},{x:12,y:12},{x:-17,y:0},{x:-15,y:-8},{x:-15,y:8},{x:-8,y:-15},{x:-8,y:15},{x:0,y:-17},{x:0,y:17},{x:8,y:-15},{x:8,y:15},{x:15,y:-8},{x:15,y:8},{x:17,y:0},{x:-17,y:-1},{x:-17,y:1},{x:-13,y:-11},{x:-13,y:11},{x:-11,y:-13},{x:-11,y:13},{x:-1,y:-17},{x:-1,y:17},{x:1,y:-17},{x:1,y:17},{x:11,y:-13},{x:11,y:13},{x:13,y:-11},{x:13,y:11},{x:17,y:-1},{x:17,y:1},{x:-16,y:-6},{x:-16,y:6},{x:-6,y:-16},{x:-6,y:16},{x:6,y:-16},{x:6,y:16},{x:16,y:-6},{x:16,y:6},{x:-17,y:-2},{x:-17,y:2},{x:-2,y:-17},{x:-2,y:17},{x:2,y:-17},{x:2,y:17},{x:17,y:-2},{x:17,y:2},{x:-14,y:-10},{x:-14,y:10},{x:-10,y:-14},{x:-10,y:14},{x:10,y:-14},{x:10,y:14},{x:14,y:-10},{x:14,y:10},{x:-17,y:-3},{x:-17,y:3},{x:-3,y:-17},{x:-3,y:17},{x:3,y:-17},{x:3,y:17},{x:17,y:-3},{x:17,y:3},{x:-17,y:-4},{x:-17,y:4},{x:-16,y:-7},{x:-16,y:7},{x:-7,y:-16},{x:-7,y:16},{x:-4,y:-17},{x:-4,y:17},{x:4,y:-17},{x:4,y:17},{x:7,y:-16},{x:7,y:16},{x:16,y:-7},{x:16,y:7},{x:17,y:-4},{x:17,y:4},{x:-15,y:-9},{x:-15,y:9},{x:-9,y:-15},{x:-9,y:15},{x:9,y:-15},{x:9,y:15},{x:15,y:-9},{x:15,y:9},{x:-13,y:-12},{x:-13,y:12},{x:-12,y:-13},{x:-12,y:13},{x:12,y:-13},{x:12,y:13},{x:13,y:-12},{x:13,y:12},{x:-17,y:-5},{x:-17,y:5},{x:-5,y:-17},{x:-5,y:17},{x:5,y:-17},{x:5,y:17},{x:17,y:-5},{x:17,y:5},{x:-14,y:-11},{x:-14,y:11},{x:-11,y:-14},{x:-11,y:14},{x:11,y:-14},{x:11,y:14},{x:14,y:-11},{x:14,y:11},{x:-16,y:-8},{x:-16,y:8},{x:-8,y:-16},{x:-8,y:16},{x:8,y:-16},{x:8,y:16},{x:16,y:-8},{x:16,y:8},{x:-18,y:0},{x:0,y:-18},{x:0,y:18},{x:18,y:0},{x:-18,y:-1},{x:-18,y:1},{x:-17,y:-6},{x:-17,y:6},{x:-15,y:-10},{x:-15,y:10},{x:-10,y:-15},{x:-10,y:15},{x:-6,y:-17},{x:-6,y:17},{x:-1,y:-18},{x:-1,y:18},{x:1,y:-18},{x:1,y:18},{x:6,y:-17},{x:6,y:17},{x:10,y:-15},{x:10,y:15},{x:15,y:-10},{x:15,y:10},{x:17,y:-6},{x:17,y:6},{x:18,y:-1},{x:18,y:1},{x:-18,y:-2},{x:-18,y:2},{x:-2,y:-18},{x:-2,y:18},{x:2,y:-18},{x:2,y:18},{x:18,y:-2},{x:18,y:2},{x:-18,y:-3},{x:-18,y:3},{x:-3,y:-18},{x:-3,y:18},{x:3,y:-18},{x:3,y:18},{x:18,y:-3},{x:18,y:3},{x:-16,y:-9},{x:-16,y:9},{x:-9,y:-16},{x:-9,y:16},{x:9,y:-16},{x:9,y:16},{x:16,y:-9},{x:16,y:9},{x:-17,y:-7},{x:-17,y:7},{x:-13,y:-13},{x:-13,y:13},{x:-7,y:-17},{x:-7,y:17},{x:7,y:-17},{x:7,y:17},{x:13,y:-13},{x:13,y:13},{x:17,y:-7},{x:17,y:7},{x:-18,y:-4},{x:-18,y:4},{x:-14,y:-12},{x:-14,y:12},{x:-12,y:-14},{x:-12,y:14},{x:-4,y:-18},{x:-4,y:18},{x:4,y:-18},{x:4,y:18},{x:12,y:-14},{x:12,y:14},{x:14,y:-12},{x:14,y:12},{x:18,y:-4},{x:18,y:4},{x:-15,y:-11},{x:-15,y:11},{x:-11,y:-15},{x:-11,y:15},{x:11,y:-15},{x:11,y:15},{x:15,y:-11},{x:15,y:11},{x:-18,y:-5},{x:-18,y:5},{x:-5,y:-18},{x:-5,y:18},{x:5,y:-18},{x:5,y:18},{x:18,y:-5},{x:18,y:5},{x:-17,y:-8},{x:-17,y:8},{x:-8,y:-17},{x:-8,y:17},{x:8,y:-17},{x:8,y:17},{x:17,y:-8},{x:17,y:8},{x:-16,y:-10},{x:-16,y:10},{x:-10,y:-16},{x:-10,y:16},{x:10,y:-16},{x:10,y:16},{x:16,y:-10},{x:16,y:10},{x:-18,y:-6},{x:-18,y:6},{x:-6,y:-18},{x:-6,y:18},{x:6,y:-18},{x:6,y:18},{x:18,y:-6},{x:18,y:6},{x:-19,y:0},{x:0,y:-19},{x:0,y:19},{x:19,y:0},{x:-19,y:-1},{x:-19,y:1},{x:-1,y:-19},{x:-1,y:19},{x:1,y:-19},{x:1,y:19},{x:19,y:-1},{x:19,y:1},{x:-19,y:-2},{x:-19,y:2},{x:-14,y:-13},{x:-14,y:13},{x:-13,y:-14},{x:-13,y:14},{x:-2,y:-19},{x:-2,y:19},{x:2,y:-19},{x:2,y:19},{x:13,y:-14},{x:13,y:14},{x:14,y:-13},{x:14,y:13},{x:19,y:-2},{x:19,y:2},{x:-15,y:-12},{x:-15,y:12},{x:-12,y:-15},{x:-12,y:15},{x:12,y:-15},{x:12,y:15},{x:15,y:-12},{x:15,y:12},{x:-19,y:-3},{x:-19,y:3},{x:-17,y:-9},{x:-17,y:9},{x:-9,y:-17},{x:-9,y:17},{x:-3,y:-19},{x:-3,y:19},{x:3,y:-19},{x:3,y:19},{x:9,y:-17},{x:9,y:17},{x:17,y:-9},{x:17,y:9},{x:19,y:-3},{x:19,y:3},{x:-18,y:-7},{x:-18,y:7},{x:-7,y:-18},{x:-7,y:18},{x:7,y:-18},{x:7,y:18},{x:18,y:-7},{x:18,y:7},{x:-19,y:-4},{x:-19,y:4},{x:-16,y:-11},{x:-16,y:11},{x:-11,y:-16},{x:-11,y:16},{x:-4,y:-19},{x:-4,y:19},{x:4,y:-19},{x:4,y:19},{x:11,y:-16},{x:11,y:16},{x:16,y:-11},{x:16,y:11},{x:19,y:-4},{x:19,y:4},{x:-19,y:-5},{x:-19,y:5},{x:-5,y:-19},{x:-5,y:19},{x:5,y:-19},{x:5,y:19},{x:19,y:-5},{x:19,y:5},{x:-18,y:-8},{x:-18,y:8},{x:-8,y:-18},{x:-8,y:18},{x:8,y:-18},{x:8,y:18},{x:18,y:-8},{x:18,y:8},{x:-17,y:-10},{x:-17,y:10},{x:-10,y:-17},{x:-10,y:17},{x:10,y:-17},{x:10,y:17},{x:17,y:-10},{x:17,y:10},{x:-14,y:-14},{x:-14,y:14},{x:14,y:-14},{x:14,y:14},{x:-15,y:-13},{x:-15,y:13},{x:-13,y:-15},{x:-13,y:15},{x:13,y:-15},{x:13,y:15},{x:15,y:-13},{x:15,y:13},{x:-19,y:-6},{x:-19,y:6},{x:-6,y:-19},{x:-6,y:19},{x:6,y:-19},{x:6,y:19},{x:19,y:-6},{x:19,y:6},{x:-20,y:0},{x:-16,y:-12},{x:-16,y:12},{x:-12,y:-16},{x:-12,y:16},{x:0,y:-20},{x:0,y:20},{x:12,y:-16},{x:12,y:16},{x:16,y:-12},{x:16,y:12},{x:20,y:0},{x:-20,y:-1},{x:-20,y:1},{x:-1,y:-20},{x:-1,y:20},{x:1,y:-20},{x:1,y:20},{x:20,y:-1},{x:20,y:1},{x:-20,y:-2},{x:-20,y:2},{x:-2,y:-20},{x:-2,y:20},{x:2,y:-20},{x:2,y:20},{x:20,y:-2},{x:20,y:2},{x:-18,y:-9},{x:-18,y:9},{x:-9,y:-18},{x:-9,y:18},{x:9,y:-18},{x:9,y:18},{x:18,y:-9},{x:18,y:9},{x:-20,y:-3},{x:-20,y:3},{x:-3,y:-20},{x:-3,y:20},{x:3,y:-20},{x:3,y:20},{x:20,y:-3},{x:20,y:3},{x:-19,y:-7},{x:-19,y:7},{x:-17,y:-11},{x:-17,y:11},{x:-11,y:-17},{x:-11,y:17},{x:-7,y:-19},{x:-7,y:19},{x:7,y:-19},{x:7,y:19},{x:11,y:-17},{x:11,y:17},{x:17,y:-11},{x:17,y:11},{x:19,y:-7},{x:19,y:7},{x:-20,y:-4},{x:-20,y:4},{x:-4,y:-20},{x:-4,y:20},{x:4,y:-20},{x:4,y:20},{x:20,y:-4},{x:20,y:4},{x:-15,y:-14},{x:-15,y:14},{x:-14,y:-15},{x:-14,y:15},{x:14,y:-15},{x:14,y:15},{x:15,y:-14},{x:15,y:14},{x:-18,y:-10},{x:-18,y:10},{x:-10,y:-18},{x:-10,y:18},{x:10,y:-18},{x:10,y:18},{x:18,y:-10},{x:18,y:10},{x:-20,y:-5},{x:-20,y:5},{x:-19,y:-8},{x:-19,y:8},{x:-16,y:-13},{x:-16,y:13},{x:-13,y:-16},{x:-13,y:16},{x:-8,y:-19},{x:-8,y:19},{x:-5,y:-20},{x:-5,y:20},{x:5,y:-20},{x:5,y:20},{x:8,y:-19},{x:8,y:19},{x:13,y:-16},{x:13,y:16},{x:16,y:-13},{x:16,y:13},{x:19,y:-8},{x:19,y:8},{x:20,y:-5},{x:20,y:5},{x:-17,y:-12},{x:-17,y:12},{x:-12,y:-17},{x:-12,y:17},{x:12,y:-17},{x:12,y:17},{x:17,y:-12},{x:17,y:12},{x:-20,y:-6},{x:-20,y:6},{x:-6,y:-20},{x:-6,y:20},{x:6,y:-20},{x:6,y:20},{x:20,y:-6},{x:20,y:6}];
		//var stack=d3.range(6).map(function() {return d3.range(9).map(function() {return 0;});});
		//data.forEach(function(d,i) {
		//	d.posx1=dist[stack1[d.attr1]].x;
		//	d.posx2=dist[stack2[d.attr2]].x;
		//	d.posy1=dist[stack1[d.attr1]++].y;
		//	d.posy2=dist[stack2[d.attr2]++].y;})

		data.forEach(function(d,i) {
			d.mode=[{vy:10+~~(i/100),vx:10+~~(((999-i)%100)/10),vz:10+(i%10)}];
		})


		//      +----+
		//    / 1   /|
		//   +-----+ |
		//   |     |2|
		//   |  0  | +
		//   |     |/
		//   +-----+
		//
		//
		//  0 - z=0
 		//  1 - y=0
		//  2 - x=0



		data.sort(function(a,b) {return a.attr[0]-b.attr[0];})
		data.forEach(function(d,i) {j=1000-i;
					d.mode.push({vz:0, vx:j%30, vy:~~(j/30)});
		})
		data.sort(function(a,b) {return a.attr[1]-b.attr[1];})
		data.forEach(function(d,i) {j=1000-i;
					d.mode.push({vy:0, vz:j%30, vx:~~(j/30)});
		})
		data.sort(function(a,b) {return a.attr[2]-b.attr[2];})
		data.forEach(function(d,i) {j=1000-i;
					d.mode.push({vx:0, vy:j%30, vz:~~(j/30)});
		})
		data.sort(function(a,b) {return b.id-a.id;})
		var mode=0;
		glyph="*%$^=#!|-§".split("");
		cols=["#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf"];
		var vis=d3.select("body").append("svg:svg").attr("width",1500).attr("height",1500)


		var cubes=vis.selectAll("rect").data(data.slice(0,1000)).enter().append("svg:g");
		cubes
		    .style("stroke","black")
			.attr("transform", function(d) {return "translate(" +
				(s*(d.mode[mode].vx+d.mode[mode].vz*depth)) + "," +
				(35*s+s*(d.mode[mode].vy-d.mode[mode].vz*depth)) + ")";});

		// 0 face
		cubes.append("svg:path").attr("d","M 0 0,h "+u+", v -"+u+", h -"+u+", Z").style("fill", function(d) {return cols[d.attr[0]];})
		// 1 face
		cubes.append("svg:path").attr("d","M 0 -"+u+", h "+u+", l "+a+" -"+a+", h -"+u+", Z").style("fill", function(d) {return cols[d.attr[1]];})
		// 2 face
		cubes.append("svg:path").attr("d","M "+u+" -"+u+", v "+u+", l "+a+" -"+a+", v -"+u+", Z").style("fill", function(d) {return cols[d.attr[2]];})
		cubes.on("click",function(d) {
		d3.select("#info").html(
			"id:"+d.id+", x:"+d.mode[mode].vx+", y:"+d.mode[mode].vy+", z:"+d.mode[mode].vz+
			"order:"+((50-d.mode[mode].vx)+50*(d.mode[mode].vz)+2500*(d.mode[mode].vy)));
		})

		//cubes.on("mousedown", transform);
		d3.select(window).on("keydown", transform);
		function transform() {
							mode=(++mode)%4;

							// now sort them cubes so that they are drawn in that order:

							  56
							 78

							  12
							 34


						/*	cubes.sort(function(a,b) {return

								(50-b.mode[mode].vx)+
								50*(b.mode[mode].vz)+
								2500*(b.mode[mode].vy)-
								(50-a.mode[mode].vx)-
								50*(a.mode[mode].vz)-
								2500*(a.mode[mode].vy)

							;})*/

							d3.select("#mode").html("mode:"+mode);
							cubes.transition()
								.attr("transform", function(d) {return "translate(" +
								(s*(d.mode[mode].vx+d.mode[mode].vz*depth)) + "," +
								(s*a+s*(d.mode[mode].vy-d.mode[mode].vz*depth)) + ")";})
								.delay(0)
								.duration(500);
			}


		</script>
		coucou le chat
	</body>
</html>

